<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#f97316">
    <meta name="description" content="Simple and elegant task manager">
    <title>My Tasks</title>
    <link rel="manifest" href="/manifest.json">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #fff7ed 0%, #fef3c7 100%);
            min-height: 100vh;
            padding: 16px;
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            max-width: 640px;
            margin: 0 auto;
        }

        .header {
            margin-bottom: 24px;
            padding-top: 32px;
        }

        .header h1 {
            font-size: 36px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 8px;
        }

        .header p {
            color: #6b7280;
            font-size: 16px;
        }

        .add-task-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 24px;
            overflow: hidden;
        }

        .task-input-wrapper {
            padding: 16px;
        }

        .task-input {
            width: 100%;
            font-size: 18px;
            border: none;
            outline: none;
            resize: none;
            font-family: inherit;
            min-height: 60px;
        }

        .task-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-top: 1px solid #f3f4f6;
        }

        .date-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: none;
            color: #f97316;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            padding: 8px;
        }

        .add-btn {
            background: #f97316;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 24px;
            transition: background 0.2s;
        }

        .add-btn:active {
            background: #ea580c;
        }

        .add-btn:disabled {
            opacity: 0.4;
        }

        .date-picker-wrapper {
            padding: 12px 16px;
            border-top: 1px solid #f3f4f6;
            display: none;
        }

        .date-picker-wrapper.show {
            display: block;
        }

        .date-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
        }

        .date-input:focus {
            border-color: #f97316;
        }

        .task-group {
            background: white;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 16px;
            overflow: hidden;
        }

        .task-group-header {
            padding: 12px 16px;
            background: #f9fafb;
            border-bottom: 1px solid #f3f4f6;
        }

        .task-group-header h3 {
            font-size: 12px;
            font-weight: 600;
            color: #374151;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .task-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 16px;
            border-bottom: 1px solid #f3f4f6;
            transition: background 0.2s;
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-item:active {
            background: #f9fafb;
        }

        .task-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid #d1d5db;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-top: 2px;
        }

        .task-checkbox.completed {
            background: #f97316;
            border-color: #f97316;
        }

        .task-checkbox svg {
            display: none;
            width: 14px;
            height: 14px;
            stroke: white;
            stroke-width: 3;
            fill: none;
        }

        .task-checkbox.completed svg {
            display: block;
        }

        .task-text {
            flex: 1;
            font-size: 16px;
            color: #111827;
            word-break: break-word;
        }

        .task-text.completed {
            text-decoration: line-through;
            color: #9ca3af;
        }

        .delete-btn {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            padding: 4px;
            flex-shrink: 0;
        }

        .delete-btn svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
        }

        .delete-btn:active {
            color: #ef4444;
        }

        .empty-state {
            text-align: center;
            padding: 64px 16px;
        }

        .empty-icon {
            width: 80px;
            height: 80px;
            background: #fed7aa;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
        }

        .empty-icon svg {
            width: 32px;
            height: 32px;
            stroke: #f97316;
            stroke-width: 2;
        }

        .empty-state p {
            color: #6b7280;
            font-size: 18px;
            margin-bottom: 4px;
        }

        .empty-state small {
            color: #9ca3af;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Tasks</h1>
            <p><span id="taskCount">0</span> tasks</p>
        </div>

        <div class="add-task-card">
            <div class="task-input-wrapper">
                <textarea id="taskInput" class="task-input" placeholder="New Task" rows="2"></textarea>
            </div>
            <div class="task-controls">
                <button class="date-btn" id="dateBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                    <span id="dateLabel">Today</span>
                </button>
                <button class="add-btn" id="addBtn" disabled>+</button>
            </div>
            <div class="date-picker-wrapper" id="datePicker">
                <input type="date" class="date-input" id="dateInput">
            </div>
        </div>

        <div id="tasksList"></div>
        
        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="empty-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            </div>
            <p>No tasks yet</p>
            <small>Add a task to get started</small>
        </div>
    </div>

    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZnVuY3Rpb24oZSkge2Uud2FpdFVudGlsKHNlbGYuc2tpcFdhaXRpbmcoKSl9KTtzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2ZldGNoJyxmdW5jdGlvbihlKXtlfSk=');
        }

        let tasks = [];
        let selectedDate = '';
        let showingDatePicker = false;

        const taskInput = document.getElementById('taskInput');
        const addBtn = document.getElementById('addBtn');
        const dateBtn = document.getElementById('dateBtn');
        const dateLabel = document.getElementById('dateLabel');
        const datePicker = document.getElementById('datePicker');
        const dateInput = document.getElementById('dateInput');
        const tasksList = document.getElementById('tasksList');
        const emptyState = document.getElementById('emptyState');
        const taskCount = document.getElementById('taskCount');

        // Initialize
        loadTasks();
        dateInput.value = getTodayDate();

        // Event Listeners
        taskInput.addEventListener('input', () => {
            addBtn.disabled = !taskInput.value.trim();
        });

        taskInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                if (taskInput.value.trim()) addTask();
            }
        });

        addBtn.addEventListener('click', addTask);

        dateBtn.addEventListener('click', () => {
            showingDatePicker = !showingDatePicker;
            datePicker.classList.toggle('show', showingDatePicker);
        });

        dateInput.addEventListener('change', () => {
            selectedDate = dateInput.value;
            dateLabel.textContent = formatDate(selectedDate);
        });

        // Functions
        function getTodayDate() {
            return new Date().toISOString().split('T')[0];
        }

        function loadTasks() {
            const stored = localStorage.getItem('myTasks');
            if (stored) {
                tasks = JSON.parse(stored);
                renderTasks();
            } else {
                emptyState.style.display = 'block';
            }
        }

        function saveTasks() {
            localStorage.setItem('myTasks', JSON.stringify(tasks));
        }

        function addTask() {
            const text = taskInput.value.trim();
            if (!text) return;

            const task = {
                id: Date.now(),
                text: text,
                date: selectedDate || getTodayDate(),
                completed: false,
                createdAt: Date.now()
            };

            tasks.push(task);
            saveTasks();
            renderTasks();

            taskInput.value = '';
            selectedDate = '';
            dateInput.value = getTodayDate();
            dateLabel.textContent = 'Today';
            addBtn.disabled = true;
            showingDatePicker = false;
            datePicker.classList.remove('show');
        }

        function toggleTask(id) {
            tasks = tasks.map(task =>
                task.id === id ? { ...task, completed: !task.completed } : task
            );
            saveTasks();
            renderTasks();
        }

        function deleteTask(id) {
            tasks = tasks.filter(task => task.id !== id);
            saveTasks();
            renderTasks();
        }

        function formatDate(dateString) {
            const today = getTodayDate();
            if (dateString === today) return 'Today';

            const date = new Date(dateString + 'T00:00:00');
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            if (dateString === tomorrow.toISOString().split('T')[0]) return 'Tomorrow';

            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function groupTasksByDate() {
            const grouped = {};
            tasks.forEach(task => {
                if (!grouped[task.date]) {
                    grouped[task.date] = [];
                }
                grouped[task.date].push(task);
            });
            return Object.entries(grouped).sort(([a], [b]) => new Date(a) - new Date(b));
        }

        function renderTasks() {
            taskCount.textContent = tasks.length;

            if (tasks.length === 0) {
                tasksList.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            const grouped = groupTasksByDate();
            
            tasksList.innerHTML = grouped.map(([date, dateTasks]) => `
                <div class="task-group">
                    <div class="task-group-header">
                        <h3>${formatDate(date)}</h3>
                    </div>
                    ${dateTasks.map(task => `
                        <div class="task-item">
                            <div class="task-checkbox ${task.completed ? 'completed' : ''}" onclick="toggleTask(${task.id})">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>
                            </div>
                            <div class="task-text ${task.completed ? 'completed' : ''}">${task.text}</div>
                            <button class="delete-btn" onclick="deleteTask(${task.id})">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                            </button>
                        </div>
                    `).join('')}
                </div>
            `).join('');
        }
    </script>
</body>
</html>

